<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ëŒ€ë¦¬ì  ë°©ë¬¸ ì§€ë„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=k8vacdhpym&submodules=geocoder"></script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<!-- SheetJS for Excel -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

<style>
html, body { margin:0; padding:0; height:100%; font-family: 'Malgun Gothic', sans-serif; }
#map { width:100vw; height:100vh; }

/* ë¡œê·¸ì¸ í™”ë©´ */
#login-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

#login-box {
  background: #fff;
  padding: 40px;
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  text-align: center;
  width: 90%;
  max-width: 350px;
}

#login-box h2 {
  margin: 0 0 30px 0;
  color: #333;
  font-size: 24px;
}

#password-input {
  width: 100%;
  padding: 12px;
  border: 2px solid #ddd;
  border-radius: 8px;
  font-size: 16px;
  box-sizing: border-box;
  text-align: center;
  margin-bottom: 20px;
}

#password-input:focus {
  outline: none;
  border-color: #667eea;
}

#login-btn {
  width: 100%;
  padding: 12px;
  background: #667eea;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: .2s;
}

#login-btn:hover {
  background: #5568d3;
}

#error-msg {
  color: #d32f2f;
  font-size: 14px;
  margin-top: 10px;
  display: none;
}

.hidden {
  display: none !important;
}

#progress {
  position:absolute;
  top:10px;
  right:10px;
  z-index:1000;
  background:#fff;
  padding:10px 16px;
  border-radius:20px;
  font-weight:bold;
  box-shadow:0 2px 8px rgba(0,0,0,.2);
}

#download-btn {
  position:absolute;
  top:50px;
  right:10px;
  z-index:1000;
  background:#4caf50;
  color:#fff;
  padding:10px 16px;
  border-radius:20px;
  font-weight:bold;
  box-shadow:0 2px 8px rgba(0,0,0,.2);
  cursor:pointer;
  border:none;
  font-size:14px;
  transition:.2s;
}

#download-btn:hover {
  background:#45a049;
}

#loading {
  position:absolute;
  top:95px;
  right:10px;
  z-index:1000;
  background:#2196f3;
  color:#fff;
  padding:8px 12px;
  border-radius:16px;
  font-size:12px;
  display:none;
}

/* ë§í’ì„  */
.bubble {
  position:relative;
  background:#fff;
  border:2px solid #d32f2f;
  border-radius:8px;
  padding:4px 10px;
  font-size:12px;
  font-weight:bold;
  white-space:nowrap;
  cursor:pointer;
  transition:.2s;
}

.bubble.visited {
  border-color:#1976d2;
  background-color:#e3f2fd;
  color:#1976d2;
}

.bubble:after {
  content:"";
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:-8px;
  width:0;
  height:0;
  border-left:6px solid transparent;
  border-right:6px solid transparent;
  border-top:8px solid #d32f2f;
}

.bubble.visited:after {
  border-top-color:#1976d2;
}

/* ëª¨ë‹¬ */
#modal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  z-index:2000;
  justify-content:center;
  align-items:center;
}

#modal.show {
  display:flex;
}

#modal-content {
  background:#fff;
  border-radius:12px;
  padding:24px;
  width:90%;
  max-width:400px;
  box-shadow:0 4px 20px rgba(0,0,0,.3);
}

#modal-title {
  font-size:18px;
  font-weight:bold;
  margin-bottom:16px;
  color:#333;
}

.modal-section {
  margin-bottom:16px;
}

.modal-section label {
  display:block;
  font-weight:bold;
  margin-bottom:8px;
  color:#555;
}

.status-buttons {
  display:flex;
  gap:8px;
}

.status-btn {
  flex:1;
  padding:10px;
  border:2px solid #ddd;
  background:#fff;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  transition:.2s;
}

.status-btn:hover {
  background:#f5f5f5;
}

.status-btn.active.visited {
  border-color:#1976d2;
  background:#1976d2;
  color:#fff;
}

.status-btn.active.not-visited {
  border-color:#d32f2f;
  background:#d32f2f;
  color:#fff;
}

#comment-input {
  width:100%;
  min-height:100px;
  padding:10px;
  border:2px solid #ddd;
  border-radius:8px;
  font-size:14px;
  resize:vertical;
  box-sizing:border-box;
  font-family:inherit;
}

#char-count {
  text-align:right;
  font-size:12px;
  color:#666;
  margin-top:4px;
}

.modal-buttons {
  display:flex;
  gap:8px;
  margin-top:20px;
}

.modal-btn {
  flex:1;
  padding:12px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  font-size:14px;
  transition:.2s;
}

.modal-btn.save {
  background:#4caf50;
  color:#fff;
}

.modal-btn.save:hover {
  background:#45a049;
}

.modal-btn.cancel {
  background:#f5f5f5;
  color:#333;
}

.modal-btn.cancel:hover {
  background:#e0e0e0;
}
</style>
</head>

<body>

<!-- ë¡œê·¸ì¸ í™”ë©´ -->
<div id="login-screen">
  <div id="login-box">
    <h2>ğŸ” ëŒ€ë¦¬ì  ë°©ë¬¸ ì§€ë„</h2>
    <input type="password" id="password-input" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
    <button id="login-btn">ë¡œê·¸ì¸</button>
    <div id="error-msg">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
  </div>
</div>

<!-- ë©”ì¸ í™”ë©´ -->
<div id="main-screen" class="hidden">
  <div id="progress">ì™„ë£Œìœ¨ 0%</div>
  <button id="download-btn">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
  <div id="loading">ì €ì¥ ì¤‘...</div>
  <div id="map"></div>
</div>

<!-- ëª¨ë‹¬ -->
<div id="modal">
  <div id="modal-content">
    <div id="modal-title"></div>
    
    <div class="modal-section">
      <label>ë°©ë¬¸ ìƒíƒœ</label>
      <div class="status-buttons">
        <button class="status-btn not-visited" data-status="false">ë¯¸ë°©ë¬¸</button>
        <button class="status-btn visited" data-status="true">ë°©ë¬¸ì™„ë£Œ</button>
      </div>
    </div>
    
    <div class="modal-section">
      <label>ì½”ë©˜íŠ¸ (500ì ì´ë‚´)</label>
      <textarea id="comment-input" maxlength="500" placeholder="ë°©ë¬¸ í›„ê¸°ë‚˜ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      <div id="char-count">0/500</div>
    </div>
    
    <div class="modal-buttons">
      <button class="modal-btn cancel">ì·¨ì†Œ</button>
      <button class="modal-btn save">ì €ì¥</button>
    </div>
  </div>
</div>

<script>
// ============================================
// ë¹„ë°€ë²ˆí˜¸ ì¸ì¦
// ============================================
const PASSWORD = "33";

function checkPassword() {
  const input = document.getElementById('password-input').value;
  if (input === PASSWORD) {
    // ë¡œê·¸ì¸ ì„±ê³µ
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('main-screen').classList.remove('hidden');
    initializeApp();
  } else {
    // ë¡œê·¸ì¸ ì‹¤íŒ¨
    document.getElementById('error-msg').style.display = 'block';
    document.getElementById('password-input').value = '';
    document.getElementById('password-input').focus();
  }
}

// ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
document.getElementById('login-btn').addEventListener('click', checkPassword);

// Enter í‚¤ë¡œ ë¡œê·¸ì¸
document.getElementById('password-input').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    checkPassword();
  }
});

// ============================================
// Firebase ì„¤ì •
// ============================================
const firebaseConfig = {
  apiKey: "AIzaSyDjTcHpGJskJNkY-qLlU02A_yDe4fCZIaI",
  authDomain: "store-map-5cf8b.firebaseapp.com",
  projectId: "store-map-5cf8b",
  storageBucket: "store-map-5cf8b.firebasestorage.app",
  messagingSenderId: "805186031186",
  appId: "1:805186031186:web:694602e04ee9579189998b"
};

// Firebase ì´ˆê¸°í™”
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ============================================
// ë§¤ì¥ ë°ì´í„°
// ============================================
const stores = [
{num:1,name:"ì‹ ë„SDR",address:"ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ88ê¸¸ 14"},
{num:2,name:"í°ì‚¬ë‘ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë‚¨êµ¬ ì–¸ì£¼ë¡œ30ê¸¸ 21"},
{num:3,name:"í•œìœ ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë‚¨êµ¬ ê´‘í‰ë¡œ51ê¸¸ 8"},
{num:4,name:"ìƒˆì„œìš¸ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë‚¨êµ¬ ì••êµ¬ì •ë¡œ 154"},
{num:5,name:"ê°•ë‚¨ìŠ¤íƒ€ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë‚¨êµ¬ ì„ ë¦‰ë¡œ 640"},
{num:6,name:"ê°•ë‚¨ìŠ¤íƒ€ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë‚¨êµ¬ ì¼ì›ë¡œ 41"},
{num:7,name:"ê°•ë‚¨ìŠ¤íƒ€ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë‚¨êµ¬ ì„ ë¦‰ë¡œ 640"},
{num:8,name:"ë¼ì´ì¦ˆ",address:"ì„œìš¸ ê°•ë‚¨êµ¬ ë…¼í˜„ë¡œ154ê¸¸ 16"},
{num:9,name:"ì˜¤ì•„ì‹œìŠ¤",address:"ì„œìš¸ ê°•ë™êµ¬ ì²œí˜¸ì˜›ê¸¸ 70"},
{num:10,name:"ì¤€ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë™êµ¬ ì²œí˜¸ëŒ€ë¡œ 1099"},
{num:11,name:"íŠ¸ë Œë“œí”Œë˜ë„ˆ",address:"ì„œìš¸ ê°•ë™êµ¬ ì²œí˜¸ì˜›ê¸¸ 70"},
{num:12,name:"ì„œìš¸entëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë™êµ¬ ê°•ë™ëŒ€ë¡œ53ê¸¸ 31"},
{num:13,name:"ì„œìš¸entëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë™êµ¬ ê°•ë™ëŒ€ë¡œ53ê¸¸ 31"},
{num:14,name:"ì•„ë¦¬ì˜¨",address:"ì„œìš¸ ê°•ë™êµ¬ ìƒì•”ë¡œ 47"},
{num:15,name:"ëŠ˜ë´„ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ë™êµ¬ ì„±ë‚´ë¡œ 6"},
{num:16,name:"í”¼ì•¤ì”¨í™€ë”©ìŠ¤",address:"ì„œìš¸ ê°•ë¶êµ¬ ì‚¼ì–‘ë¡œ 237"},
{num:17,name:"PS&M",address:"ì„œìš¸ ê°•ë¶êµ¬ ë„ë´‰ë¡œ 353"},
{num:18,name:"ì‹ ë‚˜ëŠ”",address:"ì„œìš¸ ê°•ì„œêµ¬ ê³µí•­ëŒ€ë¡œ 168"},
{num:19,name:"ì°¸ìŠ¤íƒ€ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ì„œêµ¬ ì–‘ì²œë¡œ 583"},
{num:20,name:"ë„ì¼ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ì„œêµ¬ ì–‘ì²œë¡œ 556"},
{num:21,name:"ì—¼ì°½ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ì„œêµ¬ ì–‘ì²œë¡œ 706"},
{num:22,name:"ìƒë¡ìˆ˜ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ì„œêµ¬ ê°•ì„œë¡œ 254"},
{num:23,name:"ìƒë¡ìˆ˜ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ì„œêµ¬ ê°•ì„œë¡œ 242"},
{num:24,name:"ë°±ë‘ëŒ€ê°„ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ì„œêµ¬ ì–‘ì²œë¡œ 86"},
{num:25,name:"ë™ì§„ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ì„œêµ¬ ê°•ì„œë¡œ 279"},
{num:26,name:"ì—°ìš°ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê°•ì„œêµ¬ ì›”ì •ë¡œ 160"},
{num:27,name:"ì •ì›ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê´‘ì§„êµ¬ êµ¬ì˜ê°•ë³€ë¡œ 64"},
{num:28,name:"CDëŒ€ë¦¬ì ",address:"ì„œìš¸ ê´‘ì§„êµ¬ ì²œí˜¸ëŒ€ë¡œ 597"},
{num:29,name:"ê´‘ì¥ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê´‘ì§„êµ¬ ë©´ëª©ë¡œ 160"},
{num:30,name:"ìš¸ë¦¼í„°ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê´‘ì§„êµ¬ ì•„ì°¨ì‚°ë¡œ 220"},
{num:31,name:"ì•Œë¦¬ë°”ë°”ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê´‘ì§„êµ¬ ì²œí˜¸ëŒ€ë¡œ143ê¸¸ 23"},
{num:32,name:"ì•„í† ",address:"ì„œìš¸ ê´‘ì§„êµ¬ ì²œí˜¸ëŒ€ë¡œ 571"},
{num:33,name:"CDëŒ€ë¦¬ì ",address:"ì„œìš¸ êµ¬ë¡œêµ¬ ê²½ì¸ë¡œ 661"},
{num:34,name:"êµ¬ë¡œì„œë¶€ëŒ€ë¦¬ì ",address:"ì„œìš¸ êµ¬ë¡œêµ¬ êµ¬ë¡œë™ë¡œ 82"},
{num:35,name:"PS&M",address:"ì„œìš¸ êµ¬ë¡œêµ¬ ê²½ì¸ë¡œ 661"},
{num:36,name:"PS&M",address:"ì„œìš¸ êµ¬ë¡œêµ¬ ë„ë¦¼ë¡œ 73"},
{num:37,name:"ë…ì‚°ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê¸ˆì²œêµ¬ ì‹œí¥ëŒ€ë¡œ 233"},
{num:38,name:"ì–´í”„ë ˆì‰¬ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê¸ˆì²œêµ¬ ì‹œí¥ëŒ€ë¡œ138ê¸¸ 19"},
{num:39,name:"ì§€ì€ëŒ€ë¦¬ì ",address:"ì„œìš¸ ê¸ˆì²œêµ¬ ë²šê½ƒë¡œ 234"},
{num:40,name:"ì„œìš¸entëŒ€ë¦¬ì ",address:"ì„œìš¸ ë…¸ì›êµ¬ í•œê¸€ë¹„ì„ë¡œ 384"},
{num:41,name:"ì•ŒíŒŒëŒ€ë¦¬ì ",address:"ì„œìš¸ ë…¸ì›êµ¬ ì„ê³„ë¡œ 4"},
{num:42,name:"ì‹ ì°½ëŒ€ë¦¬ì ",address:"ì„œìš¸ ë„ë´‰êµ¬ ë•ë¦‰ë¡œ 248-1"},
{num:43,name:"ì„œìš¸ì‹ ë‹¹ëŒ€ë¦¬ì ",address:"ì„œìš¸ ë™ëŒ€ë¬¸êµ¬ ì²œí˜¸ëŒ€ë¡œ 14"},
{num:44,name:"707",address:"ì„œìš¸ ë§ˆí¬êµ¬ ì›”ë“œì»µë¡œ 62"},
{num:45,name:"ìš¸ë¦¼í„°ëŒ€ë¦¬ì ",address:"ì„œìš¸ ë§ˆí¬êµ¬ ì–‘í™”ë¡œ 45"},
{num:46,name:"í“¨ì²˜ìŠ¤",address:"ì„œìš¸ ë§ˆí¬êµ¬ ëª¨ë˜ë‚´ë¡œ 5"},
{num:47,name:"ë…¼í˜„ì—­ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì„œì´ˆêµ¬ ì‚¬í‰ëŒ€ë¡œ55ê¸¸ 149"},
{num:48,name:"ë¯¸ë˜ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì„±ë™êµ¬ ë§ˆì¥ë¡œ 284-1"},
{num:49,name:"í•œìœ ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì„±ë™êµ¬ ì•„ì°¨ì‚°ë¡œ 33"},
{num:50,name:"SKëª¨ë°”ì¼í¬íƒˆ",address:"ì„œìš¸ ì„±ë™êµ¬ ì•„ì°¨ì‚°ë¡œ 38"},
{num:51,name:"ëŠ˜í‘¸ë¥¸ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì„±ë¶êµ¬ ë™ì†Œë¬¸ë¡œ 17"},
{num:52,name:"ì •ë¦‰ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì„±ë¶êµ¬ ë³´êµ­ë¬¸ë¡œ 81"},
{num:53,name:"ì•ŒíŒŒëŒ€ë¦¬ì ",address:"ì„œìš¸ ì„±ë¶êµ¬ ê¸¸ìŒë¡œ 33"},
{num:54,name:"ACEëŒ€ë¦¬ì ",address:"ì„œìš¸ ì„±ë¶êµ¬ í™”ë‘ë¡œ 248"},
{num:55,name:"PS&M",address:"ì„œìš¸ ì„±ë¶êµ¬ ì•„ë¦¬ë‘ë¡œ 10"},
{num:56,name:"ë¸Œë ˆì¸ì•„ì´ì”¨í‹°",address:"ì„œìš¸ ì†¡íŒŒêµ¬ ë²•ì›ë¡œ11ê¸¸ 11"},
{num:57,name:"ì—ìŠ¤ì•Œ",address:"ì„œìš¸ ì†¡íŒŒêµ¬ ë²•ì›ë¡œ8ê¸¸ 7"},
{num:58,name:"ì°¸ìŠ¤íƒ€ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì–‘ì²œêµ¬ ë‚¨ë¶€ìˆœí™˜ë¡œ 585"},
{num:59,name:"í•œìœ ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì–‘ì²œêµ¬ ëª©ë™ë™ë¡œ 379"},
{num:60,name:"ì—ìŠ¤ì•Œ",address:"ì„œìš¸ ì–‘ì²œêµ¬ ì§€ì–‘ë¡œ 74"},
{num:61,name:"ë°±ë‘ëŒ€ê°„ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì–‘ì²œêµ¬ ëª©ë™ì„œë¡œ 349"},
{num:62,name:"ì„œìš¸entëŒ€ë¦¬ì ",address:"ì„œìš¸ ì˜ë“±í¬êµ¬ ë„ì˜ë¡œ 27"},
{num:63,name:"ìœ í†µìƒê°€ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì˜ë“±í¬êµ¬ ì˜ë“±í¬ë¡œ 131"},
{num:64,name:"ìœ ì›ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì˜ë“±í¬êµ¬ ì„ ìœ ë¡œ49ê¸¸ 23"},
{num:65,name:"ìƒˆìƒ˜ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì˜ë“±í¬êµ¬ ë‹¹ì‚°ë¡œ 83"},
{num:66,name:"íœíƒ€ê³¤",address:"ì„œìš¸ ìš©ì‚°êµ¬ í•œê°•ëŒ€ë¡œ7ê¸¸ 10-8"},
{num:67,name:"í”„ë¦¬ìŠ¤ë¹„",address:"ì„œìš¸ ìš©ì‚°êµ¬ í•œê°•ëŒ€ë¡œ 283-8"},
{num:68,name:"í”¼ì•¤ì”¨í™€ë”©ìŠ¤",address:"ì„œìš¸ ìš©ì‚°êµ¬ ì´íƒœì›ë¡œ 187"},
{num:69,name:"í•œìœ ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì€í‰êµ¬ ì—°ì„œë¡œ 75"},
{num:70,name:"ë²”êµëŒ€ë¦¬ì ",address:"ì„œìš¸ ì€í‰êµ¬ ìˆ˜ìƒ‰ë¡œ 195"},
{num:71,name:"ì‹ ë“œë¡¬ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì€í‰êµ¬ ì„œì˜¤ë¦‰ë¡œ 173"},
{num:72,name:"ì°¸ìŠ¤íƒ€ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì¢…ë¡œêµ¬ ì†¡ì›”ê¸¸ 99"},
{num:73,name:"ìœ ë‹ˆì¿±ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì¢…ë¡œêµ¬ ì„±ê· ê´€ë¡œ 15"},
{num:74,name:"ìœ ì„ ëŒ€ë¦¬ì ",address:"ì„œìš¸ ì¤‘êµ¬ ë‹¤ì‚°ë¡œ 132"},
{num:75,name:"í”„ë¦¬ìŠ¤ë¹„",address:"ì„œìš¸ ì¤‘êµ¬ ë™í˜¸ë¡œ 180"},
{num:76,name:"Orange",address:"ì„œìš¸ ì¤‘êµ¬ ëª…ë™3ê¸¸ 6"},
{num:77,name:"í”¼ì•¤ì”¨í™€ë”©ìŠ¤",address:"ì„œìš¸ ì¤‘ë‘êµ¬ ìš©ë§ˆì‚°ë¡œ115ê¸¸ 127"},
{num:78,name:"PS&M",address:"ì„œìš¸ ì¤‘ë‘êµ¬ ë™ì¼ë¡œ 801"}
];

let storeData = {};
let currentStore = null;
let map;

// ============================================
// Firebase í•¨ìˆ˜ë“¤
// ============================================

async function loadDataFromFirebase() {
  try {
    const snapshot = await db.collection('stores').get();
    snapshot.forEach(doc => {
      storeData[doc.id] = doc.data();
    });
    console.log('Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', Object.keys(storeData).length + 'ê°œ');
    updateAllBubbles();
    updateProgress();
  } catch (error) {
    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
  }
}

async function saveDataToFirebase(storeNum, data) {
  showLoading(true);
  try {
    await db.collection('stores').doc(String(storeNum)).set(data);
    console.log(`ë§¤ì¥ ${storeNum} ì €ì¥ ì™„ë£Œ`);
    showLoading(false);
  } catch (error) {
    console.error('ì €ì¥ ì‹¤íŒ¨:', error);
    alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    showLoading(false);
  }
}

function showLoading(show) {
  document.getElementById('loading').style.display = show ? 'block' : 'none';
}

function updateAllBubbles() {
  Object.keys(storeData).forEach(num => {
    const bubble = document.getElementById(`b-${num}`);
    if (bubble && storeData[num].visited) {
      bubble.classList.add('visited');
    }
  });
}

// ============================================
// ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
// ============================================

function downloadExcel() {
  const excelData = [];
  excelData.push(['ë„˜ë²„', 'ëŒ€ë¦¬ì  ì´ë¦„', 'ëŒ€ë¦¬ì  ì£¼ì†Œ', 'ì™„ë£Œ ì—¬ë¶€', 'ì½”ë©˜íŠ¸']);
  
  stores.forEach(store => {
    const data = storeData[store.num] || {visited: false, comment: ""};
    excelData.push([
      store.num,
      store.name,
      store.address,
      data.visited ? 'ì™„ë£Œ' : 'ë¯¸ë°©ë¬¸',
      data.comment || ''
    ]);
  });
  
  const ws = XLSX.utils.aoa_to_sheet(excelData);
  ws['!cols'] = [
    {wch: 8},
    {wch: 25},
    {wch: 35},
    {wch: 12},
    {wch: 50}
  ];
  
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'ëŒ€ë¦¬ì  ë°©ë¬¸ í˜„í™©');
  
  const today = new Date();
  const dateStr = `${today.getFullYear()}${String(today.getMonth()+1).padStart(2,'0')}${String(today.getDate()).padStart(2,'0')}`;
  const filename = `ëŒ€ë¦¬ì _ë°©ë¬¸í˜„í™©_${dateStr}.xlsx`;
  
  XLSX.writeFile(wb, filename);
}

document.getElementById('download-btn').addEventListener('click', downloadExcel);

// ============================================
// ê¸°ì¡´ í•¨ìˆ˜ë“¤
// ============================================

function updateProgress(){
  const total = stores.length;
  const done = Object.values(storeData).filter(v=>v.visited).length;
  const percent = Math.round((done/total)*100);
  document.getElementById("progress").innerText =
    `ì™„ë£Œìœ¨ ${done}/${total} (${percent}%)`;
}

function openModal(storeNum){
  currentStore = storeNum;
  const store = stores.find(s => s.num === storeNum);
  const data = storeData[storeNum] || {visited: false, comment: ""};
  
  document.getElementById("modal-title").innerText = 
    `${store.num}. ${store.name}`;
  
  document.querySelectorAll(".status-btn").forEach(btn => {
    btn.classList.remove("active");
    if(btn.dataset.status === String(data.visited)){
      btn.classList.add("active");
    }
  });
  
  const textarea = document.getElementById("comment-input");
  textarea.value = data.comment || "";
  updateCharCount();
  
  document.getElementById("modal").classList.add("show");
}

function closeModal(){
  document.getElementById("modal").classList.remove("show");
  currentStore = null;
}

async function saveModal(){
  const visitedBtn = document.querySelector(".status-btn.active");
  const visited = visitedBtn ? visitedBtn.dataset.status === "true" : false;
  const comment = document.getElementById("comment-input").value;
  
  const data = {visited, comment, updatedAt: new Date().toISOString()};
  storeData[currentStore] = data;
  
  await saveDataToFirebase(currentStore, data);
  
  const bubble = document.getElementById(`b-${currentStore}`);
  if(visited){
    bubble.classList.add("visited");
  } else {
    bubble.classList.remove("visited");
  }
  
  updateProgress();
  closeModal();
}

function updateCharCount(){
  const textarea = document.getElementById("comment-input");
  const count = textarea.value.length;
  document.getElementById("char-count").innerText = `${count}/500`;
}

document.querySelector(".modal-btn.cancel").addEventListener('click', closeModal);
document.querySelector(".modal-btn.save").addEventListener('click', saveModal);
document.getElementById("comment-input").addEventListener('input', updateCharCount);

document.querySelectorAll(".status-btn").forEach(btn => {
  btn.addEventListener("click", function(){
    document.querySelectorAll(".status-btn").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
  });
});

document.getElementById("modal").addEventListener("click", function(e){
  if(e.target === this){
    closeModal();
  }
});

// ============================================
// ì•± ì´ˆê¸°í™” (ë¡œê·¸ì¸ í›„ ì‹¤í–‰)
// ============================================

async function initializeApp() {
  await loadDataFromFirebase();
  
  naver.maps.onJSContentLoaded = function(){
    map = new naver.maps.Map("map", {
      center: new naver.maps.LatLng(37.55,126.97),
      zoom: 11
    });

    const bounds = new naver.maps.LatLngBounds();

    stores.forEach((store,index)=>{
      if (!storeData[store.num]) {
        storeData[store.num] = {visited: false, comment: ""};
      }

      setTimeout(()=>{
        naver.maps.Service.geocode(
          {query:store.address},
          function(status,res){
            if(status !== naver.maps.Service.Status.OK) return;

            const addr = res.v2.addresses[0];
            const pos = new naver.maps.LatLng(addr.y, addr.x);
            bounds.extend(pos);

            const isVisited = storeData[store.num].visited ? 'visited' : '';

            const marker = new naver.maps.Marker({
              position: pos,
              map: map,
              icon:{
                content:`
                  <div class="bubble ${isVisited}" id="b-${store.num}">
                    ${store.num}. ${store.name}
                  </div>
                `,
                anchor: new naver.maps.Point(50,40)
              }
            });

            naver.maps.Event.addListener(marker,"click",()=>{
              openModal(store.num);
            });

            if(index === stores.length-1){
              map.fitBounds(bounds);
              updateProgress();
            }
          }
        );
      }, index*40);
    });
  };
  
  // Naver Mapsê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ ì¦‰ì‹œ ì‹¤í–‰
  if (typeof naver !== 'undefined' && naver.maps) {
    naver.maps.onJSContentLoaded();
  }
}
</script>

</body>
</html>
