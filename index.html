<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ëŒ€ë¦¬ì  ë°©ë¬¸ ê´€ë¦¬ ì§€ë„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    html, body, #map { height:100%; margin:0; }

    .status-box {
      position:absolute; top:10px; left:10px;
      background:#fff; padding:10px 14px;
      border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.18);
      font-size:14px; z-index:1000;
    }
    .status-box .percent {
      font-size:20px; font-weight:bold; color:#1976d2;
    }

    .export-box {
      position:absolute; top:10px; right:10px; z-index:1000;
    }
    .export-box button {
      padding:8px 12px; border:none; border-radius:6px;
      background:#1976d2; color:#fff; cursor:pointer;
    }

    .popup-btn {
      padding:6px 10px; border:none; border-radius:4px;
      font-size:13px; cursor:pointer; margin-right:4px;
    }
    .btn-visit { background:#1976d2; color:#fff; }
    .btn-unvisit { background:#999; color:#fff; }

    textarea {
      width:100%; height:70px; resize:none;
      font-size:12px; margin-top:6px;
    }
    .char-count {
      font-size:11px; text-align:right; color:#666;
    }
  </style>
</head>

<body>
<div id="map"></div>

<div class="status-box">
  <div>ğŸ“ ë°©ë¬¸ ì™„ë£Œìœ¨</div>
  <div class="percent" id="percentText">0%</div>
  <div id="countText">0 / 41 ì™„ë£Œ</div>
</div>

<div class="export-box">
  <button onclick="exportCSV()">ğŸ“¥ CSV ë‹¤ìš´ë¡œë“œ</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const TOTAL_COUNT = 41;

/* ì§€ë„ */
const map = L.map("map").setView([37.56, 126.98], 11);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19
}).addTo(map);

const markers = L.featureGroup().addTo(map);
const storeMarkers = {};

/* ì•„ì´ì½˜ */
function numberIcon(no, visited) {
  const color = visited ? "#1976d2" : "#d32f2f";
  return L.divIcon({
    html:`<div style="
      width:30px;height:30px;border-radius:50%;
      background:${color};color:#fff;font-weight:bold;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 2px 6px rgba(0,0,0,.35);">
      ${no}</div>`,
    iconSize:[30,30],
    iconAnchor:[15,30],
    className:""
  });
}

/* 1~41 ìœ„ì¹˜ ë°ì´í„° */
const locations = [
  {no:1,name:"ìš¸ë¦¼í„°ëŒ€ë¦¬ì  êµ°ìì—­ì ",lat:37.5569,lng:127.0786,addr:"ì„œìš¸ ê´‘ì§„êµ¬ êµ°ìë™ 477-19"},
  {no:2,name:"ë‹¤ì›ëŒ€ë¦¬ì  ì¤‘ê³¡ì§ì˜ì ",lat:37.5608,lng:127.0832,addr:"ì„œìš¸ ê´‘ì§„êµ¬ ê¸´ê³ ë‘ë¡œ 115"},
  {no:3,name:"ê´‘ì¥ëŒ€ë¦¬ì  ì¤‘ê³¡ì ",lat:37.5652,lng:127.0815,addr:"ì„œìš¸ ê´‘ì§„êµ¬ ë©´ëª©ë¡œ 160"},
  {no:4,name:"ìš¸ë¦¼í„°ëŒ€ë¦¬ì  ë³¸ì ",lat:37.5409,lng:127.0714,addr:"ì„œìš¸ ê´‘ì§„êµ¬ ì•„ì°¨ì‚°ë¡œ 220"},
  {no:5,name:"ê´‘ì¥ëŒ€ë¦¬ì  êµ¬ì˜ì ",lat:37.5383,lng:127.0839,addr:"ì„œìš¸ ê´‘ì§„êµ¬ ì•„ì°¨ì‚°ë¡œ 415"},
  {no:6,name:"ìš¸ë¦¼í„°ëŒ€ë¦¬ì  ê±´ëŒ€ì´ë§ˆíŠ¸ì ",lat:37.5416,lng:127.0719,addr:"ì„œìš¸ ê´‘ì§„êµ¬ ìì–‘ë™ 227-7"},
  {no:7,name:"ìš¸ë¦¼í„°ëŒ€ë¦¬ì  êµ¬ì˜ì—­ì ",lat:37.5375,lng:127.0856,addr:"ì„œìš¸ ê´‘ì§„êµ¬ ìì–‘ë¡œ 93"},
  {no:8,name:"ì•ŒíŒŒëŒ€ë¦¬ì  ë…¸ì›ì§ì˜ì ",lat:37.6569,lng:127.0635,addr:"ì„œìš¸ ë…¸ì›êµ¬ ë…¸í•´ë¡œ 490"},
  {no:9,name:"ì‹ ì°½ëŒ€ë¦¬ì  ê³µë¦‰ì—­ì ",lat:37.6269,lng:127.0727,addr:"ì„œìš¸ ë…¸ì›êµ¬ ë™ì¼ë¡œ 1077"},
  {no:10,name:"ê°€ëŠ¥ëŒ€ë¦¬ì  ìƒê³„ì§ì˜ì ",lat:37.6551,lng:127.0612,addr:"ì„œìš¸ ë…¸ì›êµ¬ ë™ì¼ë¡œ 1379"},
  {no:11,name:"PS&M ë§ˆë“¤ì—­ì ",lat:37.6642,lng:127.0576,addr:"ì„œìš¸ ë…¸ì›êµ¬ ë™ì¼ë¡œ 1538"},
  {no:12,name:"ì„œìš¸entëŒ€ë¦¬ì  ê³µë¦‰ì§ì˜ì ",lat:37.6247,lng:127.0756,addr:"ì„œìš¸ ë…¸ì›êµ¬ ë™ì¼ë¡œ192ê¸¸ 11"},
  {no:13,name:"ì‹ ì°½ëŒ€ë¦¬ì  ë…¸ì›ì—­ì§ì˜ì ",lat:37.6556,lng:127.0617,addr:"ì„œìš¸ ë…¸ì›êµ¬ ìƒê³„ë¡œ 75"},
  {no:14,name:"ì•ŒíŒŒëŒ€ë¦¬ì  ì„ê³„ì—­ì ",lat:37.6151,lng:127.0658,addr:"ì„œìš¸ ë…¸ì›êµ¬ ì„ê³„ë¡œ 4"},
  {no:15,name:"ì‹ ì°½ëŒ€ë¦¬ì  ê´‘ìš´ëŒ€ì ",lat:37.6233,lng:127.0589,addr:"ì„œìš¸ ë…¸ì›êµ¬ ì„ê³„ë¡œ 95"},
  {no:16,name:"ACEëŒ€ë¦¬ì  ì€í–‰ì‚¬ê±°ë¦¬ì ",lat:37.6461,lng:127.0736,addr:"ì„œìš¸ ë…¸ì›êµ¬ í•œê¸€ë¹„ì„ë¡œ 254"},
  {no:17,name:"ì„œìš¸entëŒ€ë¦¬ì  ìƒê³„ì—­ì ",lat:37.6602,lng:127.0731,addr:"ì„œìš¸ ë…¸ì›êµ¬ í•œê¸€ë¹„ì„ë¡œ 384"},
  {no:18,name:"ìƒë¡ìˆ˜ëŒ€ë¦¬ì  ìš°ì¥ì‚°ì ",lat:37.5483,lng:126.8364,addr:"ì„œìš¸ ê°•ì„œêµ¬ ê°•ì„œë¡œ 242"},
  {no:19,name:"ë™ì§„ëŒ€ë¦¬ì  ê°•ì„œì¤‘ì•™ì ",lat:37.5489,lng:126.8419,addr:"ì„œìš¸ ê°•ì„œêµ¬ ê°•ì„œë¡œ 279"},
  {no:20,name:"ë™ì§„ëŒ€ë¦¬ì  ê¹Œì¹˜ì‚°ì—­ ë³¸ì ",lat:37.5316,lng:126.8462,addr:"ì„œìš¸ ê°•ì„œêµ¬ ê°•ì„œë¡œ 63"},
  {no:21,name:"ì°¸ìŠ¤íƒ€ëŒ€ë¦¬ì  ë“±ì´Œì ",lat:37.5538,lng:126.8612,addr:"ì„œìš¸ ê°•ì„œêµ¬ ê°•ì„œë¡œ56ê¸¸ 16"},
  {no:22,name:"ì‹ ë‚˜ëŠ” ë§ˆê³¡ì§ì˜ì ",lat:37.5594,lng:126.8339,addr:"ì„œìš¸ ê°•ì„œêµ¬ ê³µí•­ëŒ€ë¡œ 168"},
  {no:23,name:"ê°•ì„œëŒ€ë¦¬ì  ì—¼ì°½ì—­ì ",lat:37.5462,lng:126.8748,addr:"ì„œìš¸ ê°•ì„œêµ¬ ê³µí•­ëŒ€ë¡œ 635"},
  {no:24,name:"ë™ì§„ëŒ€ë¦¬ì  ë§ˆê³¡ë³¸ì ",lat:37.5619,lng:126.8275,addr:"ì„œìš¸ ê°•ì„œêµ¬ ë§ˆê³¡ë™ 727-1271"},
  {no:25,name:"ë™ì§„ëŒ€ë¦¬ì  ë§ˆê³¡ë‚˜ë£¨ì ",lat:37.5661,lng:126.8284,addr:"ì„œìš¸ ê°•ì„œêµ¬ ë§ˆê³¡ì¤‘ì•™ë¡œ 161-17"},
  {no:26,name:"ì°¸ìŠ¤íƒ€ëŒ€ë¦¬ì  ë¸”ë£¨ë‚˜ì¸ì ",lat:37.5457,lng:126.8829,addr:"ì„œìš¸ ê°•ì„œêµ¬ ì–‘ì²œë¡œ 583"},
  {no:27,name:"í°ì‚¬ë‘ëŒ€ë¦¬ì  ë°©í™”ì§ì˜ì ",lat:37.5731,lng:126.8174,addr:"ì„œìš¸ ê°•ì„œêµ¬ ì–‘ì²œë¡œ 73"},
  {no:28,name:"PS&M í™”ê³¡ì—­ì ",lat:37.5411,lng:126.8406,addr:"ì„œìš¸ ê°•ì„œêµ¬ í™”ê³¡ë¡œ 161"},
  {no:29,name:"ì„¸í•˜ëŒ€ë¦¬ì  í™”ê³¡ì—­ë³¸ì ",lat:37.5419,lng:126.8401,addr:"ì„œìš¸ ê°•ì„œêµ¬ í™”ê³¡ë¡œ 190"},
  {no:30,name:"ë™ì§„ëŒ€ë¦¬ì  í™”ê³¡ì§ì˜ì ",lat:37.5358,lng:126.8413,addr:"ì„œìš¸ ê°•ì„œêµ¬ í™”ê³¡ë¡œ25ê¸¸ 2"},
  {no:31,name:"ë™ì§„ëŒ€ë¦¬ì  ê°€ì–‘ì—­ ë³¸ì ",lat:37.5613,lng:126.8542,addr:"ì„œìš¸ ê°•ì„œêµ¬ í™”ê³¡ë¡œ68ê¸¸ 3"},
  {no:32,name:"PS&M ë“±ì´Œì—­ì ",lat:37.5512,lng:126.8643,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ê³µí•­ëŒ€ë¡œ 564"},
  {no:33,name:"ê°•ì„œëŒ€ë¦¬ì  ì‹ ì›”ë³¸ì ",lat:37.5219,lng:126.8427,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ë‚¨ë¶€ìˆœí™˜ë¡œ 354"},
  {no:34,name:"ì°¸ìŠ¤íƒ€ëŒ€ë¦¬ì  ì‹ ì›”ì ",lat:37.5228,lng:126.8456,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ë‚¨ë¶€ìˆœí™˜ë¡œ 585"},
  {no:35,name:"ìœ ì›ëŒ€ë¦¬ì  ëª©ë™41íƒ€ì›Œì ",lat:37.5264,lng:126.8752,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ëª©ë™ë™ë¡œ 293"},
  {no:36,name:"í•œìœ ëŒ€ë¦¬ì  ëª©ë™ê´‘ì¥ì§ì˜ì ",lat:37.5293,lng:126.8758,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ëª©ë™ë™ë¡œ 379"},
  {no:37,name:"ìƒˆì„œìš¸ëŒ€ë¦¬ì  ì‹ ì •ì§ì˜ì ",lat:37.5234,lng:126.8741,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ëª©ë™ë™ë¡œ 53"},
  {no:38,name:"ìœ ì›ëŒ€ë¦¬ì  ëª©ë™ë³¸ì ",lat:37.5299,lng:126.8721,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ëª©ë™ì„œë¡œ 63"},
  {no:39,name:"MDëŒ€ë¦¬ì  ì—¼ì°½ë™ì§ì˜ì ",lat:37.5507,lng:126.8729,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ëª©ë™ì¤‘ì•™ë³¸ë¡œ 126"},
  {no:40,name:"ì„¸í•˜ëŒ€ë¦¬ì  ë“±ì´Œê¹¨ë¹„ì‹œì¥ì ",lat:37.5531,lng:126.8678,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ëª©ë™ì¤‘ì•™ë¶ë¡œ 29"},
  {no:41,name:"ì„¸í•˜ ì‹ ì •ë³¸ì ",lat:37.5212,lng:126.8734,addr:"ì„œìš¸ ì–‘ì²œêµ¬ ì¤‘ì•™ë¡œ 267"}
];

/* ì™„ë£Œìœ¨ */
function updateStatus(){
  let v=0;
  locations.forEach(l=>{
    if(localStorage.getItem(`visited_${l.no}`)==="true") v++;
  });
  document.getElementById("percentText").innerText =
    Math.round(v/TOTAL_COUNT*100)+"%";
  document.getElementById("countText").innerText =
    `${v} / ${TOTAL_COUNT} ì™„ë£Œ`;
}

/* ë§ˆì»¤ */
locations.forEach(l=>{
  const visited = localStorage.getItem(`visited_${l.no}`)==="true";
  const comment = localStorage.getItem(`comment_${l.no}`)||"";

  const m = L.marker([l.lat,l.lng],{
    icon:numberIcon(l.no,visited)
  }).addTo(markers);

  storeMarkers[l.no]=m;

  m.bindPopup(`
    <b>${l.no}. ${l.name}</b><br>${l.addr}<br><br>
    <button class="popup-btn btn-visit" onclick="markVisited(${l.no})">ë°©ë¬¸ ì™„ë£Œ</button>
    <button class="popup-btn btn-unvisit" onclick="markUnvisited(${l.no})">ë°©ë¬¸ ì·¨ì†Œ</button>
    <div style="margin-top:8px;">
      <b>ì½”ë©˜íŠ¸</b>
      <textarea maxlength="300" id="comment_${l.no}"
        oninput="updateChar(${l.no},this)">${comment}</textarea>
      <div class="char-count" id="count_${l.no}">${comment.length} / 300</div>
      <button class="popup-btn btn-visit" onclick="saveComment(${l.no})">ì½”ë©˜íŠ¸ ì €ì¥</button>
    </div>
  `);
});

/* ë°©ë¬¸/ì½”ë©˜íŠ¸ */
function markVisited(no){
  localStorage.setItem(`visited_${no}`,"true");
  updateMarker(no); updateStatus();
}
function markUnvisited(no){
  localStorage.removeItem(`visited_${no}`);
  updateMarker(no); updateStatus();
}
function updateMarker(no){
  const v = localStorage.getItem(`visited_${no}`)==="true";
  storeMarkers[no].setIcon(numberIcon(no,v));
}
function saveComment(no){
  localStorage.setItem(`comment_${no}`,
    document.getElementById(`comment_${no}`).value);
  alert("ì½”ë©˜íŠ¸ ì €ì¥ë¨");
}
function updateChar(no,el){
  document.getElementById(`count_${no}`).innerText =
    `${el.value.length} / 300`;
}

/* CSV */
function exportCSV(){
  let csv="ë²ˆí˜¸,ë§¤ì¥ëª…,ì£¼ì†Œ,ë°©ë¬¸ì—¬ë¶€,ì½”ë©˜íŠ¸\n";
  locations.forEach(l=>{
    const v = localStorage.getItem(`visited_${l.no}`)==="true"?"ë°©ë¬¸":"ë¯¸ë°©ë¬¸";
    const c = (localStorage.getItem(`comment_${l.no}`)||"").replace(/"/g,'""');
    csv+=`${l.no},"${l.name}","${l.addr}",${v},"${c}"\n`;
  });
  const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="ëŒ€ë¦¬ì _ë°©ë¬¸ê²°ê³¼.csv";
  a.click();
}

updateStatus();
map.fitBounds(markers.getBounds().pad(0.15));
</script>
</body>
</html>
